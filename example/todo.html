<!DOCTYPE html>
<html>
<head>
    <title>todo example</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.6/handlebars.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.serializeJSON/2.7.2/jquery.serializejson.min.js"></script>
     <script src="../lib/jquery.aa.js"></script>    
</head>
<body>

<ul aa-render="todoList helpers" ><!--todoList, helpers merging.-->
    <h1>TODO:</h1>
    {{#todos}}  
        <li>
            <span>{{todoListIndex}}</span>
            <span>title : {{title}}</span>
            <span>description : {{description}}</span>
            <button aa-click="deleteTodo({{todoListIndex}}), alert('{{title}} deleted.')">x</button>
        </li>
    {{/todos}}
</ul>

<form aa-submit="addTodo($el), prevent($event)">
    <h2>ADD:</h2>
    <label>title: <input type="text" name="title"></label>
    <label>description: <input type="text" name="description"></label>
    <button type="submit">add</button>
</form>

<div>
    <span aa-render="todoList">
        {{#if todos.length}}
            total : {{ todos.length }}
        {{else}}
            empty!!!
        {{/if}}
    </span>
    <button aa-click="clearTodos, alert('clear!')">clear</button>
</div>

<button type="button" id="clear">clear2</button>

<script>
    $.aa.setData({
        todoList: {
            todos : []
        },
        helpers: {
            todoListIndex : function(){
                return $.aa.getData('todoList.todos').indexOf(this) + 1;
            }
        }
    });

    $.aa.on({
        prevent: function(e){
            e.preventDefault();
        },

        addTodo : function($form){
            values = $form.serializeJSON();

            if(values.title.trim() === '' || values.description.trim() === ''){
                alert('fill inputs!');
                return;
            }

            $form.find('input').val('');

            $.aa.getData('todoList.todos').push(values);
            $.aa.render('todoList.todos');
        },

        deleteTodo:function(num){
            $.aa.getData('todoList.todos').splice(num-1, 1);
            $.aa.render('todoList.todos');  
        },

        clearTodos: function(){
            $.aa.setData('todoList.todos', []);
            $.aa.render();
        },

        alert: function(message){
            alert(message);
        }
    });

    $('#clear').click(function(){
        $.aa.emit('clearTodos');
        return false;
    });

    $(document).aa();
</script>
</body>
</html>